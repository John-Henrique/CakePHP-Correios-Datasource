Datasource para Consultar Frete no site dos Correios.

É necessário adicionar o Plugin no bootstrap.php na pasta app/Config incluindo o bootstrap do plugin

CakePlugin::load('Correios',array('bootstrap'=>true));

Este é uma fonte de dados para consultar frete
no site dos Correios.


Antes de tudo você precisa seguir rigorosamente todos 
os procedimentos de configuração, se errar uma virgula 
não irá funcionar...
<?php

class DATABASE_CONFIG {


	/**
	 * Sua conexão padrão 
	 * não precisa mudar nada nela
	 *
	 * @var unknown_type
	 */
	var $default = array(
		'driver' => 'mysql',
		'persistent' => false,
		'host' => 'localhost',
		'login' => 'user',
		'password' => 'password',
		'database' => 'test_database_name',
		'prefix' => '',
		'encoding' => 'UTF8',
	);
	
	
	
	
	/**
	 * Data source para Correios 
	 * Apenas adicione a variavel $correio 
	 * como no exemplo abaixo e pronto
	 *
	 * @var Array
	 */
	var $correio = array(
		'datasource' => 'correio',
	);
	
	
}

?>

Se você não errou uma unica virgula tudo está pronto 
pra começar... (sim, isto era pra ser engraçado).


O funcionamento é bem simples, que nem precisa de 
muita explicação. Imaginando que você queira saber 
o frete para um determinado produto simplesmente 
faça um $this->Correio->find( 'all', $arrayConditions ) 

Veja este exemplo 
<?php

class fretes extends AppController{
	
	public $name = "frete";
	
	
	public function calcular_frete(){
	
		$this->Correio->find( 'all', array(
			'nCdServico' 		=> 'pac', 
			'sCepOrigem'		=> $this->data['Frete']['cep'], 
			'sCepDestino' 		=> $this->data['Frete']['cepdestino'], 
			'nVlPeso' 			=> $this->data['Frete']['peso'], 
			'nVlComprimento'	=> $this->data['Frete']['comprimento'], 
			'nVlAltura' 		=> $this->data['Frete']['altura'], 
			'nVlLargura' 		=> $this->data['Frete']['largura'], 
			'nCdFormato' 		=> 1, 
			'nVlValorDeclarado' => $this->data['Frete']['valor'], 
			'preco' 			=> $this->data['Frete']['valor'], 
			'nCdEmpresa' 		=> $this->data['Frete']['contrato'], 
			'sDsSenha' 			=> $this->data['Frete']['senha'],
			'quantidade'		=> $this->data['Frete']['quantidade'],
		) );
	}
	
}
?>

A documentação completa está disponível em http://www.vibemidia.com/correios-datasource-para-cakephp